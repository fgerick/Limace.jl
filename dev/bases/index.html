<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Bases · Limace.jl</title><meta name="title" content="Bases · Limace.jl"/><meta property="og:title" content="Bases · Limace.jl"/><meta property="twitter:title" content="Bases · Limace.jl"/><meta name="description" content="Documentation for Limace.jl."/><meta property="og:description" content="Documentation for Limace.jl."/><meta property="twitter:description" content="Documentation for Limace.jl."/><meta property="og:url" content="https://fgerick.github.io/Limace.jl/bases/"/><meta property="twitter:url" content="https://fgerick.github.io/Limace.jl/bases/"/><link rel="canonical" href="https://fgerick.github.io/Limace.jl/bases/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Limace.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../theory/">Theoretical background</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/inertialmodes/">Inviscid inertial modes</a></li><li><a class="tocitem" href="../examples/torsionalmodes/">Torsional Alfvén modes</a></li></ul></li><li class="is-active"><a class="tocitem" href>Bases</a><ul class="internal"><li><a class="tocitem" href="#Inviscid-velocity-basis"><span>Inviscid velocity basis</span></a></li><li><a class="tocitem" href="#Viscous-velocity-basis"><span>Viscous velocity basis</span></a></li><li><a class="tocitem" href="#Insulating-magnetic-field-basis"><span>Insulating magnetic field basis</span></a></li><li><a class="tocitem" href="#Unconstrained"><span>Unconstrained</span></a></li><li><a class="tocitem" href="#Implementing-a-new-basis"><span>Implementing a new basis</span></a></li></ul></li><li><a class="tocitem" href="../forces/">Forces</a></li><li><a class="tocitem" href="../poly/">Poly</a></li><li><a class="tocitem" href="../processing/">Postprocessing</a></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Bases</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Bases</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/fgerick/Limace.jl/blob/main/docs/src/bases.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Bases"><a class="docs-heading-anchor" href="#Bases">Bases</a><a id="Bases-1"></a><a class="docs-heading-anchor-permalink" href="#Bases" title="Permalink"></a></h1><p>Several bases are readily implemented for full sphere geometries and satisfying certain boundary and orthogonality conditions.  The most commonly encountered ones are outlined here and a small introduction into how to write a new basis is given at the end.</p><h2 id="Inviscid-velocity-basis"><a class="docs-heading-anchor" href="#Inviscid-velocity-basis">Inviscid velocity basis</a><a id="Inviscid-velocity-basis-1"></a><a class="docs-heading-anchor-permalink" href="#Inviscid-velocity-basis" title="Permalink"></a></h2><p>For an inviscid fluid, we only require <span>$\mathbf{u}\cdot\mathbf{n}=0$</span> at the boundary. This is known as the non-penetration condition. For poloidal and toroidal decomposition, this boils down to the requirement that the poloidal scalar vanishes at the boundary. The toroidal scalar remains unconstrained and we have free slip.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.Bases.s-Tuple{Type{Basis{Inviscid}}, Volume, Vararg{Any, 4}}" href="#Limace.Bases.s-Tuple{Type{Basis{Inviscid}}, Volume, Vararg{Any, 4}}"><code>Limace.Bases.s</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">s(_::Type{Basis{Inviscid}}, V::Volume, l, m, n, r) -&gt; Any
</code></pre><p class="math-container">\[s_{l,n,m}(r) = f_{l,n}(1-r^2)r^l J_n^{(1,l+1/2)}(2r^2-1)\]</p><p>with</p><p class="math-container">\[f_{l,n} = \sqrt{\frac{5+2l+4n}{4l(l+1)(n+1)^2}}\]</p><p><a href="../references/#livermore_compendium_2014">Livermore (2014)</a> (5.6), normalized to unit energy. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/bases/Inviscid.jl#L42">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.Bases.t-Tuple{Type{Basis{Inviscid}}, Volume, Vararg{Any, 4}}" href="#Limace.Bases.t-Tuple{Type{Basis{Inviscid}}, Volume, Vararg{Any, 4}}"><code>Limace.Bases.t</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">t(_::Type{Basis{Inviscid}}, V::Volume, l, m, n, r) -&gt; Any
</code></pre><p class="math-container">\[t_{l,n,m}(r) = f_{l,n}r^l J_n^{(0,l+1/2)}(2r^2-1)\]</p><p>with </p><p class="math-container">\[f_{l,n} = \sqrt{\frac{3+2l+4n}{l(l+1)}}\]</p><p><a href="../references/#livermore_compendium_2014">Livermore (2014)</a> (5.1), normalized to unit energy.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/bases/Inviscid.jl#L23">source</a></section></article><h2 id="Viscous-velocity-basis"><a class="docs-heading-anchor" href="#Viscous-velocity-basis">Viscous velocity basis</a><a id="Viscous-velocity-basis-1"></a><a class="docs-heading-anchor-permalink" href="#Viscous-velocity-basis" title="Permalink"></a></h2><p>For a viscous fluid, in addition to the non-penetration condition, we require no-slip, so that in total <span>$\mathbf{u} = \mathbf{0}$</span> at the boundary. <a href="../references/#chen_optimal_2018">Chen <em>et al.</em> (2018)</a> have written a basis that satisfies these conditions, and requires orthogonality w.r.t the vector Laplacian, so that</p><p class="math-container">\[\int \mathbf{u}_i^*\cdot\boldsymbol{\nabla}^2\mathbf{u}_j\,\mathrm{d}V = \delta_{ij}.\]</p><p>This is desirable, as the resulting projections of all considered forces are banded (if only combined with another basis that satisfies the appropriate orthogonality).</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.Bases.s-Union{Tuple{T}, Tuple{Type{Basis{Viscous}}, Volume, Any, Any, Any, T}} where T" href="#Limace.Bases.s-Union{Tuple{T}, Tuple{Type{Basis{Viscous}}, Volume, Any, Any, Any, T}} where T"><code>Limace.Bases.s</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">s(_::Type{Basis{Viscous}}, V::Volume, l, m, n, r) -&gt; Any
</code></pre><p class="math-container">\[s_{l,m,n} = f_{l,n}r^l\left( (2l+4n+1)J_{n+1}^{(0,l+1/2)}(2r^2-1)-2(2l+4n+3)J_{n}^{(0,l+1/2)}(2r^2-1) + (2l+4n+5)J_{n-1}^{(0,l+1/2)}(2r^2-1) \right)\]</p><p>with</p><p class="math-container">\[f_{l,n} = \left( 2l(l+1)(2l+4n+1)(2l+4n+3)(2l+4n+5) \right)^{-1/2}\]</p><p><a href="../references/#chen_optimal_2018">Chen <em>et al.</em> (2018)</a> (2.38), (2.39) poloidal scalar, orthogonal w.r.t ∫ u⋅∇²u dV with 0 ≤ r ≤ 1.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/bases/Viscous.jl#L41">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.Bases.t-Tuple{Type{Basis{Viscous}}, Volume, Vararg{Any, 4}}" href="#Limace.Bases.t-Tuple{Type{Basis{Viscous}}, Volume, Vararg{Any, 4}}"><code>Limace.Bases.t</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">t(_::Type{Basis{Viscous}}, V::Volume, l, m, n, r) -&gt; Any
</code></pre><p class="math-container">\[t_{l,m,n}(r) = f_{l,n}r^l\left( J_n^{(0,l+1/2)}(2r^2-1) - J_{n-1}^{(0,l+1/2)}(2r^2-1)\right)\]</p><p>with</p><p class="math-container">\[f_{l,n}=\left(l(l+1)/(2l+4n-1)+1/(2l+4n+3)\right)^{-1/2}\]</p><p><a href="../references/#chen_optimal_2018">Chen <em>et al.</em> (2018)</a> toroidal scalar, orthogonal w.r.t ∫ u⋅∇²u dV with 0 ≤ r ≤ 1.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/bases/Viscous.jl#L23">source</a></section></article><h2 id="Insulating-magnetic-field-basis"><a class="docs-heading-anchor" href="#Insulating-magnetic-field-basis">Insulating magnetic field basis</a><a id="Insulating-magnetic-field-basis-1"></a><a class="docs-heading-anchor-permalink" href="#Insulating-magnetic-field-basis" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.Bases.s-Tuple{Type{Basis{Insulating}}, Volume, Vararg{Any, 4}}" href="#Limace.Bases.s-Tuple{Type{Basis{Insulating}}, Volume, Vararg{Any, 4}}"><code>Limace.Bases.s</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">s(_::Type{Basis{Insulating}}, V::Volume, l, m, n, r) -&gt; Any
</code></pre><p class="math-container">\[s_{l,m,n}(r) = f_{l,n}r^l\left( (2l+4n+3)J_{n}^{(0,l+1/2)}(2r^2-1) -2(2l+4n-1)J_{n-1}^{(0,l+1/2)}(2r^2-1) + (2l+4n+1)J_{n-2}^{(0,l+1/2)}(2r^2-1) \right)\]</p><p>with</p><p class="math-container">\[f_{l,n} = \left( 2l(l+1)(2l+4n-3)(2l+4n-1)(2l+4n+1)\right)^{-1/2}\]</p><p><a href="../references/#gerick_interannual_2024">Gerick and Livermore (2024)</a> (A6)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/bases/Insulating.jl#L42">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.Bases.t-Tuple{Type{Basis{Insulating}}, Volume, Vararg{Any, 4}}" href="#Limace.Bases.t-Tuple{Type{Basis{Insulating}}, Volume, Vararg{Any, 4}}"><code>Limace.Bases.t</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">t(_::Type{Basis{Insulating}}, V::Volume, l, m, n, r) -&gt; Any
</code></pre><p class="math-container">\[t_{l,m,n}(r) = f_{l,n}r^l\left( J_{n}^{(0,l+1/2)}(2r^2-1) - J_{n-1}^{(0,l+1/2)}(2r^2-1)\right)\]</p><p>with</p><p class="math-container">\[f_{l,n} = \left( l(l+1)/(2l+4n-1) + 1/(2l+4n+3) \right)^{-1/2}\]</p><p><a href="../references/#gerick_interannual_2024">Gerick and Livermore (2024)</a> (A7)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/bases/Insulating.jl#L24">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.InsulatingBasis.inner_b0norm-Tuple{Any, Any}" href="#Limace.InsulatingBasis.inner_b0norm-Tuple{Any, Any}"><code>Limace.InsulatingBasis.inner_b0norm</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">inner_b0norm(
    lmn_p,
    lmn_t
) -&gt; SparseArrays.SparseMatrixCSC{ComplexF64, Int64}
</code></pre><p>Convenience functions to normalize a B₀ that is assembled from different components to have (4π/3)⁻¹ ∫₀¹ B⋅B dV = 1 Construct Aᵢⱼ = ∫₀¹ Bᵢ ⋅Bⱼ dV </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/bases/Insulating.jl#L159">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.InsulatingBasis.norm_B0fac!-Tuple{Any, Any, Any}" href="#Limace.InsulatingBasis.norm_B0fac!-Tuple{Any, Any, Any}"><code>Limace.InsulatingBasis.norm_B0fac!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">norm_B0fac!(B0fac, lmn_p, lmn_t)
</code></pre><p>Normalize <code>B0fac</code> (vector of scalars) corresponding to <code>lmn_p</code> and <code>lmn_t</code> basis elements. <code>length(B0fac)=length(lmn_p)+length(lmn_t)</code>. Final array of <code>B0fac</code> will ensure that (4π/3)⁻¹ ∫₀¹ B⋅B dV = 1.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/bases/Insulating.jl#L199">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.InsulatingBasis.unitspherenorm-Tuple{Any, Any}" href="#Limace.InsulatingBasis.unitspherenorm-Tuple{Any, Any}"><code>Limace.InsulatingBasis.unitspherenorm</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">unitspherenorm(l, n) -&gt; Any
</code></pre><p>The basis elements are normalized so that ∫₀^∞ B⋅B dV = 1. There is no external contribution for the toroidal components.  For the poloidal components with n=1, there is an external contribution (r&gt;1).  To normalize the basis elements so that ∫₀¹ B⋅B dV = 1, the following norm function can be used:</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/bases/Insulating.jl#L143">source</a></section></article><h2 id="Unconstrained"><a class="docs-heading-anchor" href="#Unconstrained">Unconstrained</a><a id="Unconstrained-1"></a><a class="docs-heading-anchor-permalink" href="#Unconstrained" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.Bases.s-Tuple{Type{Basis{Limace.UnconstrainedBasis.Unconstrained}}, Volume, Vararg{Any, 4}}" href="#Limace.Bases.s-Tuple{Type{Basis{Limace.UnconstrainedBasis.Unconstrained}}, Volume, Vararg{Any, 4}}"><code>Limace.Bases.s</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">s(
    _::Type{Basis{Limace.UnconstrainedBasis.Unconstrained}},
    V::Volume,
    l,
    m,
    n,
    r
) -&gt; Any
</code></pre><p class="math-container">\[s_{l,n,m}(r) = f_{l,n}r^l\left(J_n^{(0,l+1/2)}(2r^2-1) - J_{n-1}^{(0,l+1/2)}(2r^2-1) \right)\]</p><p>with</p><p class="math-container">\[f_{l,n} = \left( l(l+1)(2l+4n+1)\right)^{-1/2}\]</p><p><a href="../references/#livermore_compendium_2014">Livermore (2014)</a> (5.3), normalized to unit energy ∫u⋅u dV = 1.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/bases/Unconstrained.jl#L39">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.Bases.t-Tuple{Type{Basis{Limace.UnconstrainedBasis.Unconstrained}}, Volume, Vararg{Any, 4}}" href="#Limace.Bases.t-Tuple{Type{Basis{Limace.UnconstrainedBasis.Unconstrained}}, Volume, Vararg{Any, 4}}"><code>Limace.Bases.t</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">t(
    _::Type{Basis{Limace.UnconstrainedBasis.Unconstrained}},
    V::Volume,
    l,
    m,
    n,
    r
) -&gt; Any
</code></pre><p class="math-container">\[t_{l,n,m}(r) = f_{l,n}r^l J_n^{(0,l+1/2)}(2r^2-1)\]</p><p>with </p><p class="math-container">\[f_{l,n} = \sqrt{\frac{3+2l+4n}{l(l+1)}}\]</p><p><a href="../references/#livermore_compendium_2014">Livermore (2014)</a> (5.1), normalized to unit energy ∫u⋅u dV = 1.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/bases/Unconstrained.jl#L20">source</a></section></article><h2 id="Implementing-a-new-basis"><a class="docs-heading-anchor" href="#Implementing-a-new-basis">Implementing a new basis</a><a id="Implementing-a-new-basis-1"></a><a class="docs-heading-anchor-permalink" href="#Implementing-a-new-basis" title="Permalink"></a></h2><p>All bases are defined in a submodule, as parametric types <code>T</code> of a <code>Basis{T}</code> basis struct and associated with a <code>BoundaryCondition</code>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.Bases.Basis" href="#Limace.Bases.Basis"><code>Limace.Bases.Basis</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct Basis{T}</code></pre><ul><li><p><code>N::Int64</code></p></li><li><p><code>m::UnitRange{Int64}</code></p></li><li><p><code>n::UnitRange{Int64}</code></p></li><li><p><code>BC::BoundaryCondition</code></p></li><li><p><code>V::Volume</code></p></li><li><p><code>params::Dict{Symbol, Float64}</code></p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/Bases.jl#L69">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.Bases.BasisElement" href="#Limace.Bases.BasisElement"><code>Limace.Bases.BasisElement</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct BasisElement{TB&lt;:Basis, PT&lt;:Helmholtz, T&lt;:Number}</code></pre><ul><li><p><code>lmn::Tuple{Int64, Int64, Int64}</code></p></li><li><p><code>factor::Number</code></p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/Bases.jl#L263">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.Bases.BoundaryCondition" href="#Limace.Bases.BoundaryCondition"><code>Limace.Bases.BoundaryCondition</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">abstract type BoundaryCondition</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/Bases.jl#L12">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.Bases.InsulatingBC" href="#Limace.Bases.InsulatingBC"><code>Limace.Bases.InsulatingBC</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct InsulatingBC &lt;: BoundaryCondition</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/Bases.jl#L51">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.Bases.InviscidBC" href="#Limace.Bases.InviscidBC"><code>Limace.Bases.InviscidBC</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct InviscidBC &lt;: BoundaryCondition</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/Bases.jl#L27">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.Bases.NoBC" href="#Limace.Bases.NoBC"><code>Limace.Bases.NoBC</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct NoBC &lt;: BoundaryCondition</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/Bases.jl#L20">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.Bases.NoSlipBC" href="#Limace.Bases.NoSlipBC"><code>Limace.Bases.NoSlipBC</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct NoSlipBC &lt;: BoundaryCondition</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/Bases.jl#L35">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Limace.Bases.PerfectlyConductingBC" href="#Limace.Bases.PerfectlyConductingBC"><code>Limace.Bases.PerfectlyConductingBC</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct PerfectlyConductingBC &lt;: BoundaryCondition</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/fgerick/Limace.jl/blob/4fb9f9bc99372f6520c632eba78b2d9ff3f0cf2e/src/Bases.jl#L43">source</a></section></article><p>We can follow the example of <code>Limace.InsulatingBasisNoBC</code>, which implements an insulating magnetic field basis, with the boundary condition explicitly imposed afterwards.</p><p>Define a new module in a <code>.jl</code> file in the <code>bases</code> folder, and import several components of <code>Limace.jl</code> that are needed:</p><pre><code class="language-julia hljs">module InsulatingBasisNoBC

using SparseArrays


using SparseArrays
using LinearAlgebra
using DocStringExtensions

using ..Bases
using ..UnconstrainedBasis, ..InviscidBasis, ..InsulatingBasis
using ..Utils
using ..Poly

using ..Bases: nrange_p, nrange_t, nrange_p_bc, nrange_t_bc, np, nt, t, s, bcs_p, bcs_t, lmn_p_l, lmn_t_l, lmn_p, lmn_t, lmn2k_p_dict, lmn2k_t_dict, lpmax, ltmax, Sphere
import ..Bases: lpmax, ltmax, lmn_t, lmn_p, _nrange_p, _nrange_t, np, nt, t, s, nrange_p_bc, nrange_t_bc, bcs_p, bcs_t
using ..Poly: ∂</code></pre><p>We define our new basis, with the right boundary condition. Here, we choose <code>BC=NoBC()</code>, as we impose the boundary condition explicitly afterwards.</p><pre><code class="language-julia hljs">export InsulatingNoBC

struct InsulatingNoBC end

InsulatingNoBC(N; kwargs...) = Basis{InsulatingNoBC}(; N, BC=NoBC(), V=Sphere(), kwargs...)</code></pre><p>We need to define a method for <code>s</code> and <code>t</code> for our basis. In this example, we just use the <code>Unconstrained</code> basis.</p><pre><code class="language-julia hljs">s(::Type{Basis{InsulatingNoBC}}, V::Volume, l,m,n,r)  = s(Basis{Unconstrained}, V, l,m,n,r) 
t(::Type{Basis{InsulatingNoBC}}, V::Volume, l,m,n,r)  = t(Basis{Unconstrained}, V, l,m,n,r) </code></pre><p>A few additional functions need to be defined to determine the radial and spherical harmonic degrees.</p><pre><code class="language-julia hljs">@inline _nrange_p(b::Basis{InsulatingNoBC}, l) = 0:((b.N-l+1)÷2)
@inline _nrange_t(b::Basis{InsulatingNoBC}, l) = 0:((b.N-l)÷2)

@inline lpmax(b::Basis{InsulatingNoBC}) = b.N
@inline ltmax(b::Basis{InsulatingNoBC}) = b.N</code></pre><p>If we have no basis imposed in the poloidal and toroidal scalars (<code>NoBC()</code>), we need to define the explicit boundary condition functions for the toroidal (<code>bcs_t</code>) and poloidal (<code>bcs_p</code>) scalars.</p><pre><code class="language-julia hljs">@inline function bcs_t(b::Basis{InsulatingNoBC})
    fs = (@inline((l, n) -&gt; t(Basis{InsulatingNoBC}, b.V, l, 0, n, 1.0)),)
    return fs
end

@inline function bcs_p(b::Basis{InsulatingNoBC})
    fs = (@inline((l, n) -&gt; ∂(r -&gt; s(Basis{InsulatingNoBC}, b.V, l, 0, n, r), 1.0) + (l + 1) * s(Basis{InsulatingNoBC}, b.V, l, 0, n, 1.0)),)
    return fs
end

end #module</code></pre><p>Here, these are given as evaluations at the surface, <code>r=1.0</code>. We use automatic differentiation to compute the derivatives in <code>r</code> using <code>ForwardDiff.jl</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../examples/torsionalmodes/">« Torsional Alfvén modes</a><a class="docs-footer-nextpage" href="../forces/">Forces »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 7 October 2024 06:17">Monday 7 October 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
